window.vizorECharts={charts:new Map,logging:!1,changeLogging:function(t){vizorECharts.logging=t},getChart:function(t){return vizorECharts.charts.get(t)},evaluatePath:function(t,a){const e=a.split(".");let o=t;for(const t of e){if(!o.hasOwnProperty(t))return;o=o[t]}return o},fetchExternalData:async function(chartId,fetchOptions){if(null!=fetchOptions)for(item of JSON.parse(fetchOptions)){vizorECharts.logging&&(console.log("FETCH"),console.log(item));const response=await fetch(item.url,item.options);if(!response.ok)throw new Error("Failed to fetch external chart data: url="+url);var data=null;if("json"==item.fetchAs){if(data=await response.json(),vizorECharts.logging&&console.log(data),null!=item.path)try{data=vizorECharts.evaluatePath(data,item.path)}catch(t){console.log("Failed to evaluate path expression of external data source"),console.log(t)}}else"string"==item.fetchAs&&(data=await response.text());if(null!=item.afterLoad)try{const func=eval(`(${item.afterLoad})`);data=func(data)}catch(t){console.log("Failed to execute afterLoad function of external data source"),console.log(t)}window.vizorECharts.charts.get(chartId)[item.id]=data}},registerMaps:function(chartId,mapOptions){if(null!=mapOptions){var parsedOptions=eval("("+mapOptions+")");for(item of parsedOptions)vizorECharts.logging&&(console.log("MAP"),console.log(item)),"geoJSON"===item.type?echarts.registerMap(item.mapName,{geoJSON:item.geoJSON,specialAreas:item.specialAreas}):"svg"===item.type&&echarts.registerMap(item.mapName,{svg:item.svg})}},initChart:async function(id,theme,initOptions,chartOptions,mapOptions,fetchOptions){var chart=echarts.init(document.getElementById(id),theme,JSON.parse(initOptions));if(vizorECharts.charts.set(id,chart),chart.showLoading(),null!=chartOptions){await vizorECharts.fetchExternalData(id,fetchOptions),await vizorECharts.registerMaps(id,mapOptions);var parsedOptions=eval("("+chartOptions+")");vizorECharts.logging&&(console.log("CHART"),console.log(parsedOptions)),chart.setOption(parsedOptions),chart.hideLoading()}},updateChart:async function(id,chartOptions,mapOptions,fetchOptions){var chart=vizorECharts.charts.get(id);if(null!=chart){await vizorECharts.fetchExternalData(id,fetchOptions),await vizorECharts.registerMaps(id,mapOptions);var parsedOptions=eval("("+chartOptions+")");chart.setOption(parsedOptions),chart.hideLoading()}else console.error("Failed to retrieve chart "+id)},disposeChart:function(t){var a=vizorECharts.charts.get(t);null!=a?(echarts.dispose(a),vizorECharts.charts.delete(t)):console.error("Failed to dispose chart "+t)}};